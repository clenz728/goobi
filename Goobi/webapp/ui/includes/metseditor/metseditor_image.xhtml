<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:composite="http://xmlns.jcp.org/jsf/composite" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:x="http://myfaces.apache.org/tomahawk" xmlns:s="http://myfaces.apache.org/sandbox">

    <composite:interface>
    </composite:interface>

    <composite:implementation>


        <h:form id="#{idPrefix}_imageForm" prependId="false">
            <!-- nur anzeigen, wenn es ein Bild gibt -->
            <h:commandButton id="#{idPrefix}_imageBack" style="display:none" action="#{Metadaten.BildBlaettern}" value="&lt;" immediate="true">
                <x:updateActionListener value="-1" property="#{Metadaten.numberOfNavigation}" />
                <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
            </h:commandButton>
            <h:commandButton id="#{idPrefix}_imageNext" style="display:none" action="#{Metadaten.BildBlaettern}" value=">" immediate="true">
                <x:updateActionListener value="1" property="#{Metadaten.numberOfNavigation}" />
                <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
            </h:commandButton>
            <h:commandButton id="#{idPrefix}_imageBack20" style="display:none" action="#{Metadaten.BildBlaettern}" value="&lt;&lt;" immediate="true">
                <x:updateActionListener value="-20" property="#{Metadaten.numberOfNavigation}" />
                <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
            </h:commandButton>
            <h:commandButton id="#{idPrefix}_imageNext20" style="display:none" action="#{Metadaten.BildBlaettern}" value=">>" immediate="true">
                <x:updateActionListener value="20" property="#{Metadaten.numberOfNavigation}" />
                <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
            </h:commandButton>
            <h:commandButton id="#{idPrefix}_imageFirst" style="display:none" action="#{Metadaten.BildBlaettern}" value="|&lt;" immediate="true">
                <x:updateActionListener value="-#{Metadaten.bildNummer}" property="#{Metadaten.numberOfNavigation}" />
                <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
            </h:commandButton>
            <h:commandButton id="#{idPrefix}_imageLast" style="display:none" action="#{Metadaten.BildBlaettern}" value=">|" immediate="true">
                <x:updateActionListener value="#{Metadaten.bildLetztes}" property="#{Metadaten.numberOfNavigation}" />
                <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
            </h:commandButton>
            <x:panelGrid columns="1" rendered="#{Metadaten.bildNummer != '-1'}" id="#{idPrefix}_image-navigation">
                <h:panelGroup style="text-align: left">
                    <!-- Bildnavigation -->
                    <!-- nur anzeigen, wenn nicht erste Seite -->
                    <table width="400px" border="0">
                        <tr>
                            <h:panelGroup rendered="#{Metadaten.bildNummer != '1'}">

                                <td>
                                    <!-- zurueck-Schaltknopf-->
                                    <h:commandLink action="#{Metadaten.BildBlaettern}" value="#{msgs.previous}" immediate="true">
                                        <x:updateActionListener value="-1" property="#{Metadaten.numberOfNavigation}" />
                                        <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                                    </h:commandLink>
                                    <!-- Trennzeichen -->
                                    <h:outputText value=" | " />
                                </td>
                            </h:panelGroup>
                            <td align="center">
                                <h:panelGroup rendered="#{Metadaten.bildNummer != '1'}">
                                    <!-- erstes-Schaltknopf -->
                                    <h:commandLink action="#{Metadaten.BildBlaettern}" value="1" immediate="true">
                                        <x:updateActionListener value="-#{Metadaten.bildNummer}" property="#{Metadaten.numberOfNavigation}" />
                                        <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                                    </h:commandLink>
                                    <!-- Trennzeichen -->
                                    <h:outputText value=" | " />

                                    <!-- wenn Bild groesser als 2 dann vorherige Seiten -->
                                    <h:panelGroup rendered="#{Metadaten.bildNummer gt '2'}">

                                        <!-- wenn Bild groesser als 4 dann grosses Trennzeichen Seiten -->
                                        <h:outputText value=" ... | " rendered="#{Metadaten.bildNummer gt '4'}" />

                                        <!-- wenn Bild groesser als 3 dann vorvorherige Seiten -->
                                        <h:panelGroup rendered="#{Metadaten.bildNummer gt '3'}">
                                            <!-- vorvorheriges Bild -->
                                            <h:commandLink action="#{Metadaten.BildBlaettern}" value="#{Metadaten.bildNummer -2}" immediate="true">
                                                <x:updateActionListener value="-2" property="#{Metadaten.numberOfNavigation}" />
                                                <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                                            </h:commandLink>
                                            <!-- Trennzeichen -->
                                            <h:outputText value=" | " />
                                        </h:panelGroup>

                                        <!-- vorheriges Bild -->
                                        <h:commandLink action="#{Metadaten.BildBlaettern}" value="#{Metadaten.bildNummer -1}" immediate="true">
                                            <x:updateActionListener value="-1" property="#{Metadaten.numberOfNavigation}" />
                                            <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                                        </h:commandLink>
                                        <!-- Trennzeichen -->
                                        <h:outputText value=" | " />
                                    </h:panelGroup>
                                </h:panelGroup>
                                <h:outputText value="#{Metadaten.bildNummer}" style="font-weight: bold" />
                                <!-- nur anzeigen, wenn nicht letzte Seite -->
                                <h:panelGroup rendered="#{Metadaten.bildNummer != Metadaten.bildLetztes}">

                                    <!-- wenn es mindestens das vorvorletzte Bild ist -->
                                    <h:panelGroup rendered="#{Metadaten.bildNummer lt (Metadaten.bildLetztes - 1)}">
                                        <!-- Trennzeichen -->
                                        <h:outputText value=" | " />
                                        <!-- naechste Seite -->
                                        <h:commandLink action="#{Metadaten.BildBlaettern}" value="#{Metadaten.bildNummer + 1}" immediate="true">
                                            <x:updateActionListener value="1" property="#{Metadaten.numberOfNavigation}" />
                                            <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                                        </h:commandLink>
                                        <!-- wenn es mindestens das vorvorvorletzte Bild ist -->
                                        <h:panelGroup rendered="#{Metadaten.bildNummer lt (Metadaten.bildLetztes - 2)}">
                                            <!-- Trennzeichen -->
                                            <h:outputText value=" | " />
                                            <!-- Uebernaechste Seite -->
                                            <h:commandLink action="#{Metadaten.BildBlaettern}" value="#{Metadaten.bildNummer + 2}" immediate="true">
                                                <x:updateActionListener value="2" property="#{Metadaten.numberOfNavigation}" />
                                                <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                                            </h:commandLink>
                                        </h:panelGroup>
                                        <!-- wenn noch mehr als drei Seiten folgen, dann ein grosses Trennzeichen -->
                                        <h:outputText value=" | ... " rendered="#{Metadaten.bildNummer lt (Metadaten.bildLetztes - 3)}" />
                                    </h:panelGroup>
                                    <!-- Trennzeichen -->
                                    <h:outputText value=" | " />
                                    <!-- letztes-Schaltknopf -->
                                    <h:commandLink action="#{Metadaten.BildBlaettern}" value="#{Metadaten.bildLetztes}" immediate="true">
                                        <x:updateActionListener value="#{Metadaten.bildLetztes}" property="#{Metadaten.numberOfNavigation}" />
                                        <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                                    </h:commandLink>
                                </h:panelGroup>
                            </td>

                            <h:panelGroup rendered="#{Metadaten.bildNummer != Metadaten.bildLetztes}">
                                <td align="right">
                                    <!-- vorwaerts-Schaltknopf -->
                                    <!-- Trennzeichen -->
                                    <h:outputText value=" | " />
                                    <h:commandLink action="#{Metadaten.BildBlaettern}" value="#{msgs.seiteVor}" immediate="true">
                                        <x:updateActionListener value="1" property="#{Metadaten.numberOfNavigation}" />
                                        <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                                    </h:commandLink>
                                </td>

                            </h:panelGroup>
                        </tr>
                    </table>
                    <!-- Ende Bildnavigation -->
                </h:panelGroup>
                <h:outputText id="#{idPrefix}_hiddenBildNummer" value="#{Metadaten.bildNummer}" style="display: none" />
                <h:panelGroup style="text-align: center">
                    <!-- Zoom -->
                    <h:commandLink action="#{Metadaten.BildZoomMinus}" id="#{idPrefix}_zoomMinus" style="margin-left: 0px;margin-right:5px">
                        <h:graphicImage value="images/zoom-.gif" style="border: 0px;vertical-align:middle" />
                        <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                    </h:commandLink>

                    <!-- aktuelle Seite anzeigen -->
                    <x:outputText id="#{idPrefix}_txtZoom1" value="#{Metadaten.bildGroesse}%" style="font-size: 11px" onclick="document.getElementById('#{idPrefix}_txtZoom2').style.display='inline';
			       document.getElementById('#{idPrefix}_txtZoom1').style.display='none'; 
			       document.getElementById('#{idPrefix}_txtZoom2').focus();
			       document.getElementById('#{idPrefix}_txtZoom2').select();" />

                    <!-- Zoom direkt eingeben -->
                    <x:inputText id="#{idPrefix}_txtZoom2" value="#{Metadaten.bildGroesse}" style="display:none;font-size:9px;width:30px" required="true" onblur="document.getElementById('#{idPrefix}_txtZoom2').style.display='none';
      				 document.getElementById('#{idPrefix}_txtZoom1').style.display='inline';" onkeypress="return submitEnter('#{idPrefix}_goButton',event)" />
                    <x:commandButton action="#{Metadaten.BildGeheZu}" id="#{idPrefix}_cmdZoom" value="go" style="display:none" />

                    <h:commandLink action="#{Metadaten.BildZoomPlus}" id="#{idPrefix}_zoomPlus1" style="margin-left: 7px;margin-right:9px">
                        <h:graphicImage value="images/zoom+.gif" style="border: 0px;vertical-align:middle" />
                        <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                    </h:commandLink>
                    <!-- // Zoom -->

                    <!-- rotation -->
                    <h:commandLink action="#{Metadaten.rotateLeft}" id="#{idPrefix}_rotateLeft" style="margin-left: 7px;margin-right:0px">
                        <h:graphicImage value="images/rotateLeft.gif" style="border: 0px;vertical-align:middle" />
                        <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                    </h:commandLink>

                    <h:commandLink action="#{Metadaten.rotateRight}" id="#{idPrefix}_rotateRight" style="margin-left: 0px;margin-right:9px">
                        <h:graphicImage value="images/rotateRight.gif" style="border: 0px;vertical-align:middle" />
                        <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                    </h:commandLink>
                    <!-- // rotation-->

                    <!-- gehezu-Schaltknopf -->
                    <h:outputText value="#{msgs.geheZuBild}:" style="margin-left:5px;margin-right:0px;font-size: 12px" title="#{msgs.geheZuImage}" />
                    <x:inputText value="#{Metadaten.bildNummerGeheZu}" onkeypress="return submitEnter('#{idPrefix}_goButton',event)" style="width:30px;border-style: solid;border-color: silver;border-width: 1px" />
                    <x:commandButton value="go" id="#{idPrefix}_goButton" action="#{Metadaten.BildGeheZu}" style="margin-left:5px; display:none">
                        <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />

                    </x:commandButton>

                    <!-- OCR -->
                    <h:commandLink id="#{idPrefix}_ocrButton" action="#{Metadaten.showOcrResult}" rendered="#{Metadaten.showOcrButton}">
                        <h:graphicImage value="images/buttons/ocr.png" style="margin-left:14px;vertical-align:middle" />
                        <f:ajax execute="@form" render=":first_imageForm  :second_imageForm" />
                    </h:commandLink>

                    <!-- //OCR -->
                    <!-- Verlinkung des Bildes mit dem gewaehlten Strukturelement -->
                    <h:outputText value="#{msgs.bildVerlinken}:" style="margin-left:13px;font-size: 12px" title="#{msgs.verlinkungDesBildesMitStrukturelement}" />
                    <h:selectBooleanCheckbox value="#{Metadaten.bildZuStrukturelement}" onclick="document.getElementById('#{idPrefix}_goButton').click();" style="margin-left:4px" title="#{msgs.verlinkungDesBildesMitStrukturelement}" />


                </h:panelGroup>
            </x:panelGrid>


            <x:panelGroup id="#{idPrefix}_myBild">

                <h:panelGroup rendered="#{Metadaten.bildNummer != '-1' and Metadaten.ocrResult!=''}">
                    <div style="background-color: #ffffff; border-style: solid; border-width: 1px; border-color: #CCCCCC; margin-bottom: 15px; padding: 5px;">
                        <h3>
                            <h:outputText value="OCR" />
                        </h3>
                        <h:outputText value="#{Metadaten.ocrResult}" escape="false" />
                    </div>
                </h:panelGroup>


                <!-- das Bild selbst -->
                <h:graphicImage value="#{Metadaten.bild}" rendered="#{Metadaten.bildNummer != '-1'}" onclick="focusForPicture()" />
            </x:panelGroup>

            <h:panelGrid columns="3">

                <h:outputText value="#{msgs.aktuellerOrdner}: " />
                <h:selectOneMenu id="#{idPrefix}_TifFolders" style="width: 200px" value="#{Metadaten.currentTifFolder}">
                    <f:selectItems value="#{Metadaten.allTifFolders}" var="step" itemLabel="#{step}" itemValue="#{step}" />
                </h:selectOneMenu>
                <h:commandButton id="#{idPrefix}_cmdOrdnerWechseln" action="#{Metadaten.BildBlaettern}" type="submit" value="#{msgs.ordnerWechseln}">
                    <x:updateActionListener value="0" property="#{Metadaten.numberOfNavigation}" />
                </h:commandButton>

                <h:outputText value="#{msgs.setRepresentative}: " rendered="#{Metadaten.alleSeiten != null and Metadaten.checkForRepresentative}" />
                <h:selectOneMenu style="width: 200px" value="#{Metadaten.currentRepresentativePage}" rendered="#{Metadaten.alleSeiten != null and Metadaten.checkForRepresentative}">
                    <f:selectItems value="#{Metadaten.alleSeiten}" />
                </h:selectOneMenu>
                <h:commandButton action="#{Metadaten.Reload}" value="#{msgs.uebernehmen}" rendered="#{Metadaten.alleSeiten != null and Metadaten.checkForRepresentative}" />
            </h:panelGrid>




            <!-- wenn kein Bild vorhanden, dann nur Meldung -->
            <h:outputText value="- #{msgs.keinBildVorhanden} -" rendered="#{Metadaten.bildNummer == '-1'}" />
        </h:form>
    </composite:implementation>

</ui:composition>


